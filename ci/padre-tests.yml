steps:
  - template: install-rust.yml

  - script: |
      ls /dev
      env
      sudo apt-get install software-properties-common python3 python3-pip python3-setuptools
      pip3 install wheel
      pip3 install behave pyhamcrest
    displayName: Install python dependencies

  - script: |
      cd padre
      cargo test -- --nocapture
    env:
      RUST_BACKTRACE: 1
      #TODO: Turn this on when warnings fixed
      #RUSTFLAGS: '-D warnings'
    displayName: Run Padre CLI unit testing

  - script: |
      sudo apt-get install -y lldb-5.0 gcc
      sudo ln -s /usr/bin/lldb-5.0 /usr/bin/lldb
      sudo ln -s /usr/bin/lldb-server-5.0 /usr/bin/lldb-server
      sudo ln -s /usr/bin/lldb-server-5.0 /usr/lib/llvm-5.0/bin/lldb-server-5.0.0
    displayName: Install lldb and build essentials

  - script: |
      cd padre
      cargo build
    #TODO: Turn this on when warnings fixed
    #env:
    #  RUSTFLAGS: '-D warnings'
    displayName: Build Padre CLI

  - bash: |
      cd padre/integration
      ~/.local/bin/behave
    env:
      RUST_BACKTRACE: 1
    displayName: Run Padre CLI integration testing
